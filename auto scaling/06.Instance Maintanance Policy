* AWS Instance Maintenance Policy: Complete and Corrected Notes

- The Instance Maintenance Policy in an Auto Scaling Group (ASG) controls how AWS handles the replacement of EC2 instances during key operations, including:
  -  Updating instances to a newer version of the AMI (Amazon Machine Image)
  -  Replacing unhealthy instances found by health checks
  -  Ensuring the desired capacity is maintained across Availability Zones

2. Updating AMI Version: Step-by-Step
- Process:
  1. Modify your launch template:
     - Go to “Launch Instance” > select/modify your template > add a new version (e.g., version 2 with new AMI like Ubuntu)
  2. Update your ASG:
     - Go to your ASG > Launch Template > Edit > change to new version (e.g., version 2) > Update
  3. Refresh instances:
     - Go to Auto Scaling > Instance Refresh > Click “Start Instance Refresh”
     - Choose your Instance Maintenance Policy
     - Adjust instance warm-up time as required (e.g., set to 60 seconds)
     - Begin the refresh

3. Instance Maintenance Policies Explained

Terminate and Launch
- Mechanism:  
  Immediately terminates unhealthy or outdated instances, then launches replacements.
- Cost Implications:
  - Generally cost-effective because old instances are terminated before new ones start, limiting overlap.
  - *Example:* If replacing 2 instances, terminate them first, then launch 2 new ones.
- How to Set:
  - In Launch Template: Details > Instance Maintenance Policy > Edit > Update
  - During Instance Refresh: Set warm-up time (e.g., 60s), then start

Launch Before Termination
- Mechanism: 
  First launches new instances, waits for them to become healthy, then terminates the old ones.
- Cost Implications:
  - More expensive since both old and new instances temporarily run simultaneously
  - *Example:* Launch 2 replacements before terminating the previous 2, doubling capacity momentarily

Custom Policy
- Mechanism:  
  You define a custom logic for launching and terminating instances, such as staggering replacements or adding extra health verification.
- Use Cases:
  - Fine-tuning replacement processes for special requirements, compliance, or cost controls
  - Useful for applications with sensitive dependencies or long warm-up phases

Summary Table

| Policy Type            | Replacement Sequence                       | Cost Impact     | Use Case                       |
|------------------------|--------------------------------------------|-----------------|-------------------------------|
| Terminate and Launch   | Terminate old, then launch new             | Cost saving     | Fast, low-cost replacement     |
| Launch Before Termination | Launch new, then terminate old           | Higher cost     | Zero downtime, more control    |
| Custom Policy          | User-defined sequence                      | Varies          | Specialized or complex needs   |

Key Points
- Instance Maintenance Policy is central to how ASG refreshes or replaces EC2 instances during updates, health replacements, and capacity balancing.
- Terminate and Launch is cheapest, but involves short downtime.
- Launch Before Termination avoids downtime, but temporarily doubles costs.
- Custom policies give you control for advanced scenarios.
